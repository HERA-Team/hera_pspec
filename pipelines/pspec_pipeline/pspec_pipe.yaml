# pspec_pipe.yaml
#
# hera_pspec IDR2.1 pipeline
# configuration file
#
# Note: only strings, booleans, integers, floats,
# lists, and lists of lists may be specified here.
# When PSpecData parameters have required type None
# use 'None' here, and for list of tuples,
# use list of lists here.

#---------------------------------------------------------------
# IO Parameters
#---------------------------------------------------------------
io :
  work_dir : './'         # directory to work in
  out_dir : './'          # directory to dump all output in
  logfile : 'pspipe_out.log'  # logfile   
  errfile : 'pspipe_err.log' # error file
  joinlog : False       # redirect error output into logfile
  overwrite : True     # overwrite
  verbose : True        # report feedback to standard output

#---------------------------------------------------------------
# Analysis Parameters
#---------------------------------------------------------------
analysis : 
  run_diff        : False       # Run visibility data difference
  run_pspec       : True        # Run power spectrum estimation
  run_bootstrap   : True        # Run bootstrapping for errorbars
  multiproc       : False       # use multiprocess module
  nproc           : 8           # number of processes to spawn

#---------------------------------------------------------------
# Data Parameters
#---------------------------------------------------------------
data :
  # Datafile group pairs to search for
  group_pairs :
    - ['2458042', '2458042']

  # Datafile pol pairs to search for
  pol_pairs :
    - ['xx', 'xx']

  # full path to data template with {pol} and {group} fields
  data_template : './zen.{group}.?????.{pol}.HH.uvXA'
  std_template : None

  # baseline type restriction in length (meters) and angle (degrees)
  bl_len_range : [0, 10000.0]
  bl_deg_range : [0, 180]

  # denote bad antennas
  xants : []

#---------------------------------------------------------------
# Algorithm Parameters
#---------------------------------------------------------------
algorithm :

  # jacknife data difference
  diff :
    split_type : "antenna"

  # pspec pipeline
  pspec : 
    outfname : "pspec.h5"
    input_data_weight : "identity"
    norm : "I"
    taper : "none"
    beam : "HERA_NF_dipole_power.beamfits"
    cosmo : "None"
    spw_ranges :
      - [10, 20]
    n_dlys : 
      - 5
    Jy2mK : True
    rephase_to_dset : None
    trim_dset_lsts : False
    broadcast_dset_flags : True
    time_thresh : 0.2
    Nblps_per_job : 100
    exclude_auto_bls : True
    exclude_permutations : True
    bl_len_range : [0, 20]
    bl_deg_range : [40, 80]
    maxiter : 1

  # bootstrap pipeline
  bootstrap :
    psc_name : "pspec.h5"
    time_avg : True
    Nsamples : 100
    seed : None
    normal_std : True
    robust_std : True
    conf_ints : None
    keep_samples : False
    bl_error_tol : 1.0
    maxiter : 1


